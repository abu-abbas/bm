import{c as N,e as y,K as h,m as _,q as L,G as r,Q as e,x as l,u as x,U as I,L as k,C as w,E,H as U,n as z,z as G,a1 as K,F as Q,B as J,y as W}from"../../../vendor/vue-utils-cea615f1.js";import{g as R,e as C,b as H,d as M,a as X,_ as Y}from"../../../vendor/id-959b107e.js";import{_ as Z}from"../../resource/Spinner-d1bede5f.js";import{F as q,e as ee}from"../../../vendor/vue-plugins-utils-b3bb03cf.js";import"../../../vendor/common-utils-e0afba66.js";import"../../../vendor/bootstrap-utils-9ffca17a.js";import"../../../vendor/jquery-utils-4b2e19e3.js";import"../../../vendor/images-utils-205332c6.js";const te={class:"px-3 pb-0 mb-0"},ae={class:"form-group row"},se=e("label",{for:"nama",class:"col-sm-3 col-form-label"}," Username ",-1),ne={class:"col-sm-9"},oe=["readonly"],le={key:0,class:"form-text text-danger fs-nano"},ie={class:"form-group row"},re=e("label",{for:"nama",class:"col-sm-3 col-form-label"}," Nama ",-1),ce={class:"col-sm-9"},de={key:0,class:"form-text text-danger fs-nano"},ue={class:"form-group row"},me=e("label",{for:"nama",class:"col-sm-3 col-form-label"}," Password ",-1),pe={class:"col-sm-9"},_e={key:0,class:"form-text text-danger fs-nano"},fe={class:"form-group row"},be={class:"col-sm-9 offset-sm-3"},he={type:"submit",class:"btn btn-primary mr-2"},ge=["onClick"],O={__name:"ModalForm",props:{visible:{type:Boolean,required:!0,default:!1},initData:{type:[Object,null],required:!1,default:()=>{}},isEdit:{type:Boolean,required:!0,default:!1}},emits:["update:visible","submit"],setup(P,{emit:g}){const f=P,V=Math.random().toString(36).substring(2,9),F=N(()=>f.visible),a=N(()=>f.initData),S=y(null),$=y(null),B=()=>z(()=>{S.value.focus(),a.value&&($.value.setFieldValue("username",a.value.username),$.value.setFieldValue("name",a.value.name),$.value.setFieldValue("password",a.value.password))}),c=()=>g("update:visible",!1),s=(n,{resetForm:i})=>{var b;console.log(n);const o=f.isEdit,d=o?`Apakah Anda yakan untuk mengubah data ${(b=a.value)==null?void 0:b.username} ?`:`Apakah Anda yakin untuk menambahkan ${n.username} sebagai pengguna?`,p=o?"put":"post",u=`backend.user.${o?"edit":"store"}`;let t=!1;o&&Object.keys(n).forEach(m=>{n[m]!=a.value[m]&&(t=!0)}),!(o&&!t)&&R({title:`${o?"Ubah":"Tambah"} pengguna`,text:d,icon:"question"},()=>{var m;return H.post(M(u),{...n,_method:p,slug:o?(m=a.value)==null?void 0:m.username:null},{headers:{"Content-Type":"multipart/form-data"}}).then(v=>v).catch(v=>{let T=v.response.status,A=v.response.data.message;if([409,417,500].includes(T)){C.showValidationMessage(`${A}`);return}if(T=="422"){const j=v.response.data.errors;A=Object.keys(j).map(D=>Array.isArray(j[D])?j[D].join(", "):j[D]).join(", "),C.showValidationMessage(`${A}`);return}})}).then(({value:m,isConfirmed:v,isDismissed:T})=>{var A;if(T)return!1;v&&m.data.status=="success"&&(C.fire({title:"Tambah pengguna",text:m.data.message,icon:"success"}),i(),g("submit",(A=m.data)==null?void 0:A.data),c())})};return(n,i)=>{const o=h("FontAwesomeIcon"),d=h("b-modal");return _(),L(d,{id:x(V),visible:F.value,"onUpdate:visible":i[0]||(i[0]=p=>F.value=p),title:`${f.isEdit?"Ubah":"Tambah"} Pengguna`,"hide-footer":"",onShown:B,onHide:c},{default:r(({hide:p})=>[e("div",te,[l(x(ee),{ref_key:"formRef",ref:$,onSubmit:s},{default:r(()=>[e("div",ae,[se,e("div",ne,[l(x(q),{label:"Username Pengguna",name:"username",rules:"required|min:3|max:200"},{default:r(({field:u,errorMessage:t})=>[e("input",I({id:"username",ref_key:"usernameInput",ref:S},u,{type:"text",class:"form-control",placeholder:"Masukkan username pengguna",readonly:P.isEdit}),null,16,oe),t?(_(),k("div",le,w(t),1)):E("",!0)]),_:1})])]),e("div",ie,[re,e("div",ce,[l(x(q),{label:"Nama pengguna",name:"name",rules:"required|min:3|max:200"},{default:r(({field:u,errorMessage:t})=>[e("input",I({id:"nama",ref:"nameInput"},u,{type:"text",class:"form-control",placeholder:"Masukkan nama pengguna"}),null,16),t?(_(),k("div",de,w(t),1)):E("",!0)]),_:1})])]),e("div",ue,[me,e("div",pe,[l(x(q),{label:"Password Pengguna",name:"password",rules:P.isEdit?[]:"required|min:6"},{default:r(({field:u,errorMessage:t})=>[e("input",I({id:"password",ref:"passwordInput"},u,{type:"password",class:"form-control"}),null,16),t?(_(),k("div",_e,w(t),1)):E("",!0)]),_:1},8,["rules"])])]),e("div",fe,[e("div",be,[e("button",he,[l(o,{icon:["fas","save"],class:"mr-1"}),U(" Simpan ")]),e("button",{type:"reset",class:"btn btn-light",onClick:p}," Batal ",8,ge)])])]),_:2},1536)])]),_:1},8,["id","visible","title"])}}},ve={class:"section-body"},ye=e("h2",{class:"section-title fs-lg"},"Daftar Pengguna",-1),xe=e("p",{class:"section-lead"}," Daftar pengguna terdaftar ",-1),ke={class:"row"},we={class:"col-12"},$e={class:"card border-gray-light"},Ae={class:"card-body"},Ce={class:"action-wrapper d-flex mb-3 flex-wrap align-items-center justify-content-between"},Ve={class:"left-section"},Fe={class:"right-section mt-2 mt-md-0"},Pe={class:"input-group"},Se={class:"input-group-prepend"},Te={class:"input-group-text"},je={class:"text-center"},Ee=e("span",null,"Belum ada data",-1),Ue={class:"text-center"},Be=e("span",null,"Data tidak ditemukan",-1),De={class:"d-flex align-items-baseline justify-content-center"},Ie={class:"text-right"},qe={class:"d-flex flex-column"},He={class:"fs-sm text-muted"},Me={key:0},Ne=["src","alt"],Oe={class:"footer-wrapper"},Le={class:"d-flex justify-content-between align-items-center"},Ye={__name:"Index",setup(P){const g=y(null),f=y(!1),V=y(!1),F=y({}),a=y({busy:!1,fields:[{key:"action",label:"Aksi",class:"text-center",sortable:!1,thStyle:{width:"35px"}},{key:"rownum",label:"No",thStyle:{width:"35px",textAlign:"center"}},{key:"username",label:"Username",thStyle:{textAlign:"center",width:"20%"}},{key:"name",label:"Nama",thStyle:{textAlign:"center",width:"80%"}}],search:{filter:null,columns:["name","short_location","description"]},meta:{page:1,from:1,limit:15,total:0}}),S=X.debounce((c,s)=>{a.value.busy=!0,H.get(M("backend.user.get",{search:a.value.search.filter,columns:a.value.search.columns.join(","),page:c.currentPage,limit:c.perPage})).then(n=>{var i,o,d,p,u;a.value.meta.from=(i=n.data)==null?void 0:i.meta.from,a.value.meta.page=(o=n.data)==null?void 0:o.meta.current_page,a.value.meta.limit=(d=n.data)==null?void 0:d.meta.per_page,a.value.meta.total=(p=n.data)==null?void 0:p.meta.total,s((u=n.data)==null?void 0:u.data)}).catch(()=>s([])).finally(()=>setTimeout(()=>a.value.busy=!1,500))},500),$=c=>{R({title:"Hapus Pengguna",text:`Apakah Anda yakin untuk menghapus data pengguna dengan username. ${c.username}?`,icon:"question"},()=>H.post(M("backend.user.drop"),{_method:"delete",username:c.username}).then(s=>s).catch(s=>{let n=s.response.status,i=s.response.data.message;if([409,417,500].includes(n)){C.showValidationMessage(`${i}`);return}if(n=="422"){const o=s.response.data.errors;i=Object.keys(o).map(d=>Array.isArray(o[d])?o[d].join(", "):o[d]).join(", "),C.showValidationMessage(`${i}`);return}})).then(({value:s,isConfirmed:n,isDismissed:i})=>{if(i)return!1;n&&s&&C.fire({title:"Hapus Pengguna Berhasil",text:`Pengguna dengan username ${c.username} berhasil dihapus`,icon:"success"}),g.value.refresh()})},B=c=>{F.value=c,V.value=!0};return(c,s)=>{const n=h("FontAwesomeIcon"),i=h("b-button"),o=h("b-table"),d=h("b-dropdown-item"),p=h("b-dropdown"),u=h("b-pagination");return _(),k("div",ve,[ye,xe,e("div",ke,[e("div",we,[e("div",$e,[e("div",Ae,[e("div",Ce,[e("div",Ve,[e("button",{class:"btn btn-icon icon-left btn-primary",onClick:s[0]||(s[0]=t=>f.value=!0)},[l(n,{icon:["fas","plus"]}),U(" Tambah ")])]),e("div",Fe,[e("div",Pe,[e("div",Se,[e("div",Te,[l(n,{icon:["fas","search"]})])]),G(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.search.filter=t),type:"text",class:"form-control",placeholder:"Pencarian"},null,512),[[K,a.value.search.filter]])])])]),l(o,{ref_key:"refTable",ref:g,"table-class":"custom-bordered dataTable",fields:a.value.fields,items:x(S),filter:a.value.search.filter,"current-page":a.value.meta.page,"per-page":a.value.meta.limit,busy:a.value.busy,"show-empty":"",hover:"",striped:"",responsive:""},{"table-busy":r(()=>[l(Z)]),empty:r(()=>[e("div",je,[l(n,{icon:["fas","exclamation-circle"],class:"mr-2"}),Ee])]),emptyfiltered:r(()=>[e("div",Ue,[l(n,{icon:["fas","exclamation-circle"],class:"mr-2"}),Be])]),"cell(action)":r(({item:t})=>{var b;return[e("div",De,[l(i,{variant:"link",class:"text-info py-0 px-1 outline-none cursor-pointer",onClick:m=>B(t)},{default:r(()=>[l(n,{icon:["fas","edit"]})]),_:2},1032,["onClick"]),t.username!=((b=x(Y).user)==null?void 0:b.username)?(_(),L(i,{key:0,variant:"link",class:"text-danger py-0 px-1 outline-none cursor-pointer",onClick:m=>$(t)},{default:r(()=>[l(n,{icon:["fas","trash-alt"]})]),_:2},1032,["onClick"])):E("",!0)])]}),"cell(rownum)":r(({index:t})=>[e("div",Ie,w(t+1),1)]),"cell(name)":r(({item:t})=>[e("div",qe,[U(w(t.name)+" ",1),e("span",He,w(t.short_location),1)])]),"cell(logo)":r(({value:t,item:b})=>[t.thumb?(_(),k("img",{key:1,src:t.thumb,alt:b.name,class:"image-on-table"},null,8,Ne)):(_(),k("span",Me))]),_:1},8,["fields","items","filter","current-page","per-page","busy"]),e("div",Oe,[e("div",Le,[l(p,{variant:"light",class:"mr-2 form-control-height-sm perpage",text:a.value.meta.limit.toString()},{default:r(()=>[(_(),k(Q,null,J([5,10,15,25,50,100],t=>l(d,{key:t,"link-class":"btn",onClick:W(b=>a.value.meta.limit=t,["prevent"])},{default:r(()=>[U(w(t),1)]),_:2},1032,["onClick"])),64))]),_:1},8,["text"]),l(u,{value:a.value.meta.page,"onUpdate:value":s[2]||(s[2]=t=>a.value.meta.page=t),"total-rows":a.value.meta.total,"per-page":a.value.meta.limit,"aria-controls":"group-table","first-class":"hidden-md-down","last-class":"hidden-md-down",class:"pagination mb-0",onChange:s[3]||(s[3]=t=>a.value.meta.page=t)},null,8,["value","total-rows","per-page"])])])])])])]),l(O,{visible:f.value,"onUpdate:visible":s[4]||(s[4]=t=>f.value=t),onSubmit:s[5]||(s[5]=t=>g.value.refresh())},null,8,["visible"]),l(O,{visible:V.value,"onUpdate:visible":s[6]||(s[6]=t=>V.value=t),"init-data":F.value,"is-edit":!0,onSubmit:s[7]||(s[7]=t=>g.value.refresh())},null,8,["visible","init-data"])])}}};export{Ye as default};
