import{c as O,e as x,K as g,m as _,q as H,G as r,Q as t,x as l,u as v,U as I,L as k,C as w,E as P,H as U,n as G,z as K,a1 as Q,F as J,B as W,y as X}from"../../../vendor/vue-utils-92461978.js";import{g as z,e as C,b as M,d as N,a as Y,_ as L}from"../../../vendor/id-53336ca1.js";import{_ as Z}from"../../resource/Spinner-5d36ea29.js";import{F as q,e as ee}from"../../../vendor/vue-plugins-utils-2535b5ea.js";import"../../../vendor/common-utils-a1d3ee46.js";import"../../../vendor/bootstrap-utils-9ffca17a.js";import"../../../vendor/jquery-utils-4b2e19e3.js";import"../../../vendor/images-utils-205332c6.js";const te={class:"px-3 pb-0 mb-0"},ae={class:"form-group row"},se=t("label",{for:"nama",class:"col-sm-3 col-form-label"}," Username ",-1),ne={class:"col-sm-9"},oe=["readonly"],le={key:0,class:"form-text text-danger fs-nano"},ie={class:"form-group row"},re=t("label",{for:"nama",class:"col-sm-3 col-form-label"}," Nama ",-1),ce={class:"col-sm-9"},de={key:0,class:"form-text text-danger fs-nano"},ue={class:"form-group row"},me=t("label",{for:"nama",class:"col-sm-3 col-form-label"}," Password ",-1),pe={class:"col-sm-9"},_e={key:0,class:"form-text text-danger fs-nano"},fe={class:"form-group row"},be={class:"col-sm-9 offset-sm-3"},he={type:"submit",class:"btn btn-primary mr-2"},ge=["onClick"],R={__name:"ModalForm",props:{visible:{type:Boolean,required:!0,default:!1},initData:{type:[Object,null],required:!1,default:()=>{}},isEdit:{type:Boolean,required:!0,default:!1}},emits:["update:visible","submit"],setup(S,{emit:y}){const b=S,V=Math.random().toString(36).substring(2,9),F=O(()=>b.visible),a=O(()=>b.initData),T=x(null),$=x(null),B=()=>G(()=>{T.value.focus(),a.value&&($.value.setFieldValue("username",a.value.username),$.value.setFieldValue("name",a.value.name),$.value.setFieldValue("password",a.value.password))}),c=()=>y("update:visible",!1),s=(n,{resetForm:i})=>{var h;console.log(n);const o=b.isEdit,d=o?`Apakah Anda yakan untuk mengubah data ${(h=a.value)==null?void 0:h.username} ?`:`Apakah Anda yakin untuk menambahkan ${n.username} sebagai pengguna?`,p=o?"put":"post",u=`backend.user.${o?"edit":"store"}`;let e=!1;o&&Object.keys(n).forEach(m=>{n[m]!=a.value[m]&&(e=!0)}),!(o&&!e)&&z({title:`${o?"Ubah":"Tambah"} pengguna`,text:d,icon:"question"},()=>{var m;return M.post(N(u),{...n,_method:p,slug:o?(m=a.value)==null?void 0:m.username:null},{headers:{"Content-Type":"multipart/form-data"}}).then(f=>f).catch(f=>{let j=f.response.status,A=f.response.data.message;if([409,417,500].includes(j)){C.showValidationMessage(`${A}`);return}if(j=="422"){const E=f.response.data.errors;A=Object.keys(E).map(D=>Array.isArray(E[D])?E[D].join(", "):E[D]).join(", "),C.showValidationMessage(`${A}`);return}})}).then(({value:m,isConfirmed:f,isDismissed:j})=>{var A;if(j)return!1;f&&m.data.status=="success"&&(C.fire({title:"Tambah pengguna",text:m.data.message,icon:"success"}),i(),y("submit",(A=m.data)==null?void 0:A.data),c())})};return(n,i)=>{const o=g("FontAwesomeIcon"),d=g("b-modal");return _(),H(d,{id:v(V),visible:F.value,"onUpdate:visible":i[0]||(i[0]=p=>F.value=p),title:`${b.isEdit?"Ubah":"Tambah"} Pengguna`,"hide-footer":"",onShown:B,onHide:c},{default:r(({hide:p})=>[t("div",te,[l(v(ee),{ref_key:"formRef",ref:$,onSubmit:s},{default:r(()=>[t("div",ae,[se,t("div",ne,[l(v(q),{label:"Username Pengguna",name:"username",rules:"required|min:3|max:200"},{default:r(({field:u,errorMessage:e})=>[t("input",I({id:"username",ref_key:"usernameInput",ref:T},u,{type:"text",class:"form-control",placeholder:"Masukkan username pengguna",readonly:S.isEdit}),null,16,oe),e?(_(),k("div",le,w(e),1)):P("",!0)]),_:1})])]),t("div",ie,[re,t("div",ce,[l(v(q),{label:"Nama pengguna",name:"name",rules:"required|min:3|max:200"},{default:r(({field:u,errorMessage:e})=>[t("input",I({id:"nama",ref:"nameInput"},u,{type:"text",class:"form-control",placeholder:"Masukkan nama pengguna"}),null,16),e?(_(),k("div",de,w(e),1)):P("",!0)]),_:1})])]),t("div",ue,[me,t("div",pe,[l(v(q),{label:"Password Pengguna",name:"password",rules:S.isEdit?[]:"required|min:6"},{default:r(({field:u,errorMessage:e})=>[t("input",I({id:"password",ref:"passwordInput"},u,{type:"password",class:"form-control"}),null,16),e?(_(),k("div",_e,w(e),1)):P("",!0)]),_:1},8,["rules"])])]),t("div",fe,[t("div",be,[t("button",he,[l(o,{icon:["fas","save"],class:"mr-1"}),U(" Simpan ")]),t("button",{type:"reset",class:"btn btn-light",onClick:p}," Batal ",8,ge)])])]),_:2},1536)])]),_:1},8,["id","visible","title"])}}},ve={class:"section-body"},ye=t("h2",{class:"section-title fs-lg"},"Daftar Pengguna",-1),xe=t("p",{class:"section-lead"}," Daftar pengguna terdaftar ",-1),ke={class:"row"},we={class:"col-12"},$e={class:"card border-gray-light"},Ae={class:"card-body"},Ce={class:"action-wrapper d-flex mb-3 flex-wrap align-items-center justify-content-between"},Ve={class:"left-section"},Fe={class:"right-section mt-2 mt-md-0"},Pe={class:"input-group"},Se={class:"input-group-prepend"},Te={class:"input-group-text"},je={class:"text-center"},Ee=t("span",null,"Belum ada data",-1),Ue={class:"text-center"},Be=t("span",null,"Data tidak ditemukan",-1),De={class:"d-flex align-items-baseline justify-content-center"},Ie={class:"text-right"},qe={class:"d-flex flex-column"},He={class:"fs-sm text-muted"},Me={key:0},Ne=["src","alt"],Oe={class:"footer-wrapper"},Le={class:"d-flex justify-content-between align-items-center"},Ye={__name:"Index",setup(S){const y=x(null),b=x(!1),V=x(!1),F=x({}),a=x({busy:!1,fields:[{key:"action",label:"Aksi",class:"text-center",sortable:!1,thStyle:{width:"35px"}},{key:"rownum",label:"No",thStyle:{width:"35px",textAlign:"center"}},{key:"username",label:"Username",thStyle:{textAlign:"center",width:"20%"}},{key:"name",label:"Nama",thStyle:{textAlign:"center",width:"80%"}}],search:{filter:null,columns:["name","short_location","description"]},meta:{page:1,from:1,limit:15,total:0}}),T=Y.debounce((c,s)=>{a.value.busy=!0,M.get(N("backend.user.get",{search:a.value.search.filter,columns:a.value.search.columns.join(","),page:c.currentPage,limit:c.perPage})).then(n=>{var i,o,d,p,u;a.value.meta.from=(i=n.data)==null?void 0:i.meta.from,a.value.meta.page=(o=n.data)==null?void 0:o.meta.current_page,a.value.meta.limit=(d=n.data)==null?void 0:d.meta.per_page,a.value.meta.total=(p=n.data)==null?void 0:p.meta.total,s((u=n.data)==null?void 0:u.data)}).catch(()=>s([])).finally(()=>setTimeout(()=>a.value.busy=!1,500))},500),$=c=>{z({title:"Hapus Pengguna",text:`Apakah Anda yakin untuk menghapus data pengguna dengan username. ${c.username}?`,icon:"question"},()=>M.post(N("backend.user.drop"),{_method:"delete",username:c.username}).then(s=>s).catch(s=>{let n=s.response.status,i=s.response.data.message;if([409,417,500].includes(n)){C.showValidationMessage(`${i}`);return}if(n=="422"){const o=s.response.data.errors;i=Object.keys(o).map(d=>Array.isArray(o[d])?o[d].join(", "):o[d]).join(", "),C.showValidationMessage(`${i}`);return}})).then(({value:s,isConfirmed:n,isDismissed:i})=>{if(i)return!1;n&&s&&C.fire({title:"Hapus Pengguna Berhasil",text:`Pengguna dengan username ${c.username} berhasil dihapus`,icon:"success"}),y.value.refresh()})},B=c=>{F.value=c,V.value=!0};return(c,s)=>{const n=g("FontAwesomeIcon"),i=g("b-button"),o=g("b-table"),d=g("b-dropdown-item"),p=g("b-dropdown"),u=g("b-pagination");return _(),k("div",ve,[ye,xe,t("div",ke,[t("div",we,[t("div",$e,[t("div",Ae,[t("div",Ce,[t("div",Ve,[t("button",{class:"btn btn-icon icon-left btn-primary",onClick:s[0]||(s[0]=e=>b.value=!0)},[l(n,{icon:["fas","plus"]}),U(" Tambah ")])]),t("div",Fe,[t("div",Pe,[t("div",Se,[t("div",Te,[l(n,{icon:["fas","search"]})])]),K(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>a.value.search.filter=e),type:"text",class:"form-control",placeholder:"Pencarian"},null,512),[[Q,a.value.search.filter]])])])]),l(o,{ref_key:"refTable",ref:y,"table-class":"custom-bordered dataTable",fields:a.value.fields,items:v(T),filter:a.value.search.filter,"current-page":a.value.meta.page,"per-page":a.value.meta.limit,busy:a.value.busy,"show-empty":"",hover:"",striped:"",responsive:""},{"table-busy":r(()=>[l(Z)]),empty:r(()=>[t("div",je,[l(n,{icon:["fas","exclamation-circle"],class:"mr-2"}),Ee])]),emptyfiltered:r(()=>[t("div",Ue,[l(n,{icon:["fas","exclamation-circle"],class:"mr-2"}),Be])]),"cell(action)":r(({item:e})=>{var h,m;return[t("div",De,[!e.is_etpp&&e.username!=((h=v(L).user)==null?void 0:h.username)?(_(),H(i,{key:0,variant:"link",class:"text-info py-0 px-1 outline-none cursor-pointer",onClick:f=>B(e)},{default:r(()=>[l(n,{icon:["fas","edit"]})]),_:2},1032,["onClick"])):P("",!0),!e.is_etpp&&e.username!=((m=v(L).user)==null?void 0:m.username)?(_(),H(i,{key:1,variant:"link",class:"text-danger py-0 px-1 outline-none cursor-pointer",onClick:f=>$(e)},{default:r(()=>[l(n,{icon:["fas","trash-alt"]})]),_:2},1032,["onClick"])):P("",!0)])]}),"cell(rownum)":r(({index:e})=>[t("div",Ie,w(e+1),1)]),"cell(name)":r(({item:e})=>[t("div",qe,[U(w(e.name)+" ",1),t("span",He,w(e.short_location),1)])]),"cell(logo)":r(({value:e,item:h})=>[e.thumb?(_(),k("img",{key:1,src:e.thumb,alt:h.name,class:"image-on-table"},null,8,Ne)):(_(),k("span",Me))]),_:1},8,["fields","items","filter","current-page","per-page","busy"]),t("div",Oe,[t("div",Le,[l(p,{variant:"light",class:"mr-2 form-control-height-sm perpage",text:a.value.meta.limit.toString()},{default:r(()=>[(_(),k(J,null,W([5,10,15,25,50,100],e=>l(d,{key:e,"link-class":"btn",onClick:X(h=>a.value.meta.limit=e,["prevent"])},{default:r(()=>[U(w(e),1)]),_:2},1032,["onClick"])),64))]),_:1},8,["text"]),l(u,{value:a.value.meta.page,"onUpdate:value":s[2]||(s[2]=e=>a.value.meta.page=e),"total-rows":a.value.meta.total,"per-page":a.value.meta.limit,"aria-controls":"group-table","first-class":"hidden-md-down","last-class":"hidden-md-down",class:"pagination mb-0",onChange:s[3]||(s[3]=e=>a.value.meta.page=e)},null,8,["value","total-rows","per-page"])])])])])])]),l(R,{visible:b.value,"onUpdate:visible":s[4]||(s[4]=e=>b.value=e),onSubmit:s[5]||(s[5]=e=>y.value.refresh())},null,8,["visible"]),l(R,{visible:V.value,"onUpdate:visible":s[6]||(s[6]=e=>V.value=e),"init-data":F.value,"is-edit":!0,onSubmit:s[7]||(s[7]=e=>y.value.refresh())},null,8,["visible","init-data"])])}}};export{Ye as default};
