import{e as q,c as S,K as H,m as o,L as i,Q as e,x as n,F as G,B as z,E as f,q as K,C as w,n as Q,o as X,G as p,u as _,U as y,H as Y}from"../../vendor/vue-utils-92461978.js";import{F as x,e as Z}from"../../vendor/vue-plugins-utils-2535b5ea.js";import{b as L,d as P,g as ee,e as R}from"../../vendor/id-53336ca1.js";import{_ as te}from"./CropperImage-c8d3b76f.js";const ae={class:"uploader-image-wrapper"},se={for:"file-input",class:"border"},oe=["accept"],le=["src"],ne=["onClick"],ie={key:0,class:"fs-nano text-danger"},re={__name:"UploadingImage",props:{accept:{type:Array,required:!1,default:()=>["image/gif","image/jpg","image/jpeg","image/png","image/tiff"]},maxSize:{type:Number,required:!1,default:5},modelValue:{type:[Array,null],required:!0,default:null},urlObject:{type:[Array,null],required:!1,default:null},errorMessage:{type:[String,null],required:!1,default:null}},emits:["update:modelValue","update:urlObject","cropping"],setup(j,{emit:F}){const V=j,T=window.URL||window.webkitURL,v=q([]),s=S(()=>V.accept.join(",")),O=l=>{if(!l.target.files.length)return;Array.from(l.target.files).forEach(r=>{const h={visible:!0,input:T.createObjectURL(r),output:null,name:r.name,mime:r.type,file:null};v.value.push(h)}),Q(()=>l.target.value="")},b=({image:l})=>{const m=v.value[v.value.length-1];m.output=T.createObjectURL(l),m.file=new File([l],m.name,{type:m.mime}),U()},C=l=>{v.value.splice(l,1),U()},U=()=>{const l=v.value.map(r=>r.file),m=v.value.map(r=>r.output);F("update:modelValue",l),F("update:urlObject",m),F("cropping",{files:l,urlObjects:m})};return(l,m)=>{const r=H("FontAwesomeIcon");return o(),i("div",ae,[e("label",se,[n(r,{icon:["far","image"]}),e("input",{id:"file-input",type:"file",name:"upload",multiple:"",accept:s.value,onChange:O},null,40,oe)]),(o(!0),i(G,null,z(v.value,(h,B)=>(o(),i("div",{key:B,class:"preview-wrapper"},[h.output?(o(),i("img",{key:0,src:h.output,class:"image-preview",alt:"Output after crop and resize"},null,8,le)):f("",!0),e("a",{href:"javascript:void(0)",onClick:$=>C(B)},[n(r,{icon:["fas","trash-alt"]})],8,ne),h.visible?(o(),K(te,{key:1,visible:h.visible,"onUpdate:visible":$=>h.visible=$,"image-url":h.input,onAfterCropping:b},null,8,["visible","onUpdate:visible","image-url"])):f("",!0)]))),128)),j.errorMessage?(o(),i("div",ie,w(j.errorMessage),1)):f("",!0)])}}};const ce={class:"px-3 pb-0 mb-0"},ue={class:"form-group row"},de=e("label",{for:"tenant",class:"col-sm-3 col-form-label"}," Tenan ",-1),me={class:"col-sm-9"},pe={key:0,class:"form-text text-danger fs-nano"},_e={class:"form-group row"},fe=e("label",{for:"name",class:"col-sm-3 col-form-label"}," Nama Barang ",-1),ve={class:"col-sm-9"},he={key:0,class:"form-text text-danger fs-nano"},be={class:"form-group row"},ge=e("label",{for:"deskripsi",class:"col-sm-3 col-form-label"}," Deskripsi ",-1),ke={class:"col-sm-9"},ye={key:0,class:"form-text text-danger fs-nano"},xe={class:"form-group row"},we=e("label",{for:"min_qty",class:"col-sm-3 col-form-label"}," Minimum Kuantiti ",-1),qe={class:"col-sm-9"},Fe={key:0,class:"form-text text-danger fs-nano"},Ve={class:"form-group row"},Ae=e("label",{for:"min_unit",class:"col-sm-3 col-form-label"}," Minimum Unit ",-1),je={class:"col-sm-9"},Ce={key:0,class:"form-text text-danger fs-nano"},Ue={class:"form-group row"},$e=e("label",{for:"tkdn",class:"col-sm-3 col-form-label"}," Nilai TKDN ",-1),Ie={class:"col-sm-9"},Te={key:0,class:"form-text text-danger fs-nano"},Be={class:"form-group row"},Ne=e("label",{for:"price",class:"col-sm-3 col-form-label"}," Harga ",-1),De={class:"col-sm-9"},He={key:0,class:"form-text text-danger fs-nano"},Oe={class:"form-group row"},Ee=e("label",{for:"condition",class:"col-sm-3 col-form-label"}," Kondisi ",-1),Me={class:"col-sm-9"},Re={key:0,class:"form-text text-danger fs-nano"},Se={class:"form-group row"},Ke=e("label",{class:"col-sm-3 col-form-label"}," Gambar ",-1),Le={class:"col-sm-9"},Pe={key:0,class:"preview-wrapper"},Ge=["src","alt"],ze=["onClick"],Qe={class:"form-group row"},Je={class:"col-sm-9 offset-sm-3"},We={type:"submit",class:"btn btn-primary mr-2"},Xe=["onClick"],at={__name:"ModalForm",props:{visible:{type:Boolean,required:!0,default:!1},initData:{type:[Object,null],required:!1,default:()=>{}},isEdit:{type:Boolean,required:!0,default:!1}},emits:["update:visible","submit"],setup(j,{emit:F}){const V=j;X(()=>{h()});const T=Math.random().toString(36).substring(2,9),v=S(()=>V.visible),s=S(()=>V.initData),O=q(null),b=q(null),C=q(!1),U=q([]),l=q(null),m=q([{text:"Baru",value:"0"},{text:"Bekas",value:"1"}]),r=q(null),h=async()=>{try{const c=(await(await L.get(P("backend.tenant.get",{})).then(k=>k)).data.data).map(k=>({text:k.name,value:k.id}));U.value=c,c.length>0&&(l.value=c[0].value)}catch(d){console.error("Error fetching data from the API:",d)}},B=()=>Q(()=>{s.value&&(console.log(s.value),r.value={value:s.value.condition,text:s.value.condition==0?"Baru":"Bekas"},l.value={value:s.value.tenant_id,text:s.value.tenant_name},b.value.setFieldValue("name",s.value.product_name),b.value.setFieldValue("description",s.value.description),b.value.setFieldValue("min_qty",s.value.minimum_qty),b.value.setFieldValue("min_unit",s.value.minimum_unit),b.value.setFieldValue("price",s.value.price),b.value.setFieldValue("tkdn",s.value.tkdn_value),C.value=!0)}),$=()=>F("update:visible",!1),J=d=>{d>=0&&d<s.value.images.length&&(s.value.images.splice(d,1),s.value.images.length===0&&(C.value=!1))},W=(d,{resetForm:g})=>{const c=V.isEdit,k=c?`Apakah Anda yakan untuk mengubah data ${d.name} ?`:`Apakah Anda yakin untuk menambahkan barang ${d.name} ?`,E=c?"put":"post",I=`backend.product.${c?"edit":"store"}`;let a=!1;c&&Object.keys(d).forEach(t=>{d[t]!=s.value[t]&&(a=!0)}),!(c&&!a)&&ee({title:`${c?"Ubah":"Tambah"} barang`,text:k,icon:"question"},()=>{var t;return L.post(P(I),{...d,_method:E,slug:c?(t=s.value)==null?void 0:t.slug:null},{headers:{"Content-Type":"multipart/form-data"}}).then(u=>u).catch(u=>{let N=u.response.status,A=u.response.data.message;if([409,417,500].includes(N)){R.showValidationMessage(`${A}`);return}if(N=="422"){const D=u.response.data.errors;A=Object.keys(D).map(M=>Array.isArray(D[M])?D[M].join(", "):D[M]).join(", "),R.showValidationMessage(`${A}`);return}})}).then(({value:t,isConfirmed:u,isDismissed:N})=>{var A;if(N)return!1;u&&t.data.status=="success"&&(R.fire({title:"Tambah barang",text:t.data.message,icon:"success"}),g(),F("submit",(A=t.data)==null?void 0:A.data),$())})};return(d,g)=>{const c=H("vue-multiselect"),k=H("FontAwesomeIcon"),E=H("b-modal");return o(),K(E,{id:_(T),visible:v.value,"onUpdate:visible":g[2]||(g[2]=I=>v.value=I),title:`${V.isEdit?"Ubah":"Tambah"} Barang`,"hide-footer":"",onShown:B,onHide:$},{default:p(({hide:I})=>[e("div",ce,[n(_(Z),{ref_key:"formRef",ref:b,onSubmit:W},{default:p(()=>[e("div",ue,[de,e("div",me,[n(_(x),{label:"Nama tenant",name:"tenant",rules:"required"},{default:p(({field:a,errorMessage:t})=>[n(c,y({modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=u=>l.value=u),options:U.value,"close-on-select":!0,"clear-on-select":!1,placeholder:"Pilih nama tenan"},a,{label:"text","track-by":"text"}),null,16,["modelValue","options"]),t?(o(),i("div",pe,w(t),1)):f("",!0)]),_:1})])]),e("div",_e,[fe,e("div",ve,[n(_(x),{label:"Nama barang",name:"name",rules:"required|min:3|max:200"},{default:p(({field:a,errorMessage:t})=>[e("input",y({id:"name",ref_key:"nameInput",ref:O},a,{type:"text",class:"form-control",placeholder:"Masukkan nama barang"}),null,16),t?(o(),i("div",he,w(t),1)):f("",!0)]),_:1})])]),e("div",be,[ge,e("div",ke,[n(_(x),{label:"Deskripsi",name:"description",rules:"required|max:2000"},{default:p(({field:a,errorMessage:t})=>[e("textarea",y({id:"deskripsi"},a,{type:"text",class:"form-control custom-scroll",placeholder:"Masukkan deskripsi tentang barang"}),null,16),t?(o(),i("div",ye,w(t),1)):f("",!0)]),_:1})])]),e("div",xe,[we,e("div",qe,[n(_(x),{label:"Minimum kuantiti",name:"min_qty",rules:"required|min:1|max:11"},{default:p(({field:a,errorMessage:t})=>[e("input",y({id:"min_qty"},a,{type:"number",class:"form-control",placeholder:"Masukkan jumlah minimum kuantity"}),null,16),t?(o(),i("div",Fe,w(t),1)):f("",!0)]),_:1})])]),e("div",Ve,[Ae,e("div",je,[n(_(x),{label:"Nama barang",name:"min_unit",rules:"required|min:1|max:11"},{default:p(({field:a,errorMessage:t})=>[e("input",y({id:"min_unit"},a,{class:"form-control",placeholder:"Masukkan minimum unit"}),null,16),t?(o(),i("div",Ce,w(t),1)):f("",!0)]),_:1})])]),e("div",Ue,[$e,e("div",Ie,[n(_(x),{label:"Nilai TKDN",name:"tkdn",rules:"required|min:3|max:5"},{default:p(({field:a,errorMessage:t})=>[e("input",y({id:"tkdn"},a,{class:"form-control",placeholder:"Masukkan nilai TKDN"}),null,16),t?(o(),i("div",Te,w(t),1)):f("",!0)]),_:1})])]),e("div",Be,[Ne,e("div",De,[n(_(x),{label:"Harga",name:"price",rules:"required|min:1|max:200"},{default:p(({field:a,errorMessage:t})=>[e("input",y({id:"price"},a,{type:"number",class:"form-control",placeholder:"Masukkan harga"}),null,16),t?(o(),i("div",He,w(t),1)):f("",!0)]),_:1})])]),e("div",Oe,[Ee,e("div",Me,[n(_(x),{label:"Kondisi",name:"condition",rules:"required"},{default:p(({field:a,errorMessage:t})=>[n(c,y({modelValue:r.value,"onUpdate:modelValue":g[1]||(g[1]=u=>r.value=u),options:m.value,"close-on-select":!0,"clear-on-select":!1,placeholder:"Pilih kondisi"},a,{label:"text","track-by":"text"}),null,16,["modelValue","options"]),t?(o(),i("div",Re,w(t),1)):f("",!0)]),_:1})])]),e("div",Se,[Ke,e("div",Le,[C.value?(o(),i("div",Pe,[(o(!0),i(G,null,z(s.value.images,(a,t)=>{var u;return o(),i("div",{key:t},[e("img",{src:(u=s.value)==null?void 0:u.images[t],alt:a.product_name,class:"image-preview"},null,8,Ge),e("a",{href:"javascript:void(0)",onClick:()=>J(t)},[n(k,{icon:["fas","trash-alt"]})],8,ze)])}),128))])):(o(),K(_(x),{key:1,label:"Gambar",name:"pict",rules:"required"},{default:p(({field:a,errorMessage:t})=>[n(re,y(a,{"error-message":t}),null,16,["error-message"])]),_:1}))])]),e("div",Qe,[e("div",Je,[e("button",We,[n(k,{icon:["fas","save"],class:"mr-1"}),Y(" Simpan ")]),e("button",{type:"reset",class:"btn btn-light",onClick:I}," Batal ",8,Xe)])])]),_:2},1536)])]),_:1},8,["id","visible","title"])}}};export{at as _};
