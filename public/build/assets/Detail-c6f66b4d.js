import{o as pe,c as ue,r as h,hn as P,ho as H,j as g,b as x,k as Y,fT as v,f as e,fx as i,u as X,hr as ve,hq as fe,fR as _e,e as M,fB as V,fC as he,fV as J,fJ as be,hC as Z,hp as w,fX as ge,fH as ye,g as ke,ge as xe,fy as we,fz as $e,i as Te}from"./vee-validate-i18n.esm-8795b5a9.js";import{C as Ce,X as Ae}from"./vue-multiselect.esm-5ac34b22.js";import{u as Se}from"./event-store-9038ca00.js";import{_ as je}from"./Spinner-f1d6211d.js";import{_ as me}from"./UploadingImageTenant-8bd98e2e.js";import"./CropperImage-bc84b991.js";const De={class:"px-3 pb-0 mb-0"},Ve={class:"form-group row"},Ie=e("label",{for:"nama",class:"col-sm-3 col-form-label"}," Tenant ",-1),Me={class:"col-sm-9"},Be={key:0,class:"form-text text-danger fs-nano"},Ee={class:"form-group row"},Re={class:"col-sm-9 offset-sm-3"},Pe={type:"submit",class:"btn btn-primary mr-2"},He=["onClick"],qe={__name:"ModalFormLinkTenant",props:{visible:{type:Boolean,required:!0,default:!1},initData:{type:[Object,null],required:!1,default:()=>{}},eventId:{type:[String,null],required:!1,default:()=>{}},tenantEvent:{type:[Object,null],required:!1,default:()=>{}},isEdit:{type:Boolean,required:!0,default:!1}},emits:["update:visible","submit"],setup(Q,{emit:q}){const S=Q;pe(()=>{z()});const y=Math.random().toString(36).substring(2,9),O=ue(()=>S.visible),c=ue(()=>S.initData),U=h(null),j=h([]),B=h([]),z=async()=>{try{const b=(await(await P.get(H("backend.tenant.get",{limit:1e3,no_product:!0})).then(k=>k)).data.data).map(k=>({text:k.name,value:k.id}));j.value=b}catch(f){console.error("Error fetching data from the API:",f)}},F=()=>be(()=>{}),L=()=>q("update:visible",!1),G=(f,{resetForm:s})=>{const b=S.isEdit,k="Apakah Anda yakan untuk menyimpan data tenant yang berpartisipasi ?",N=b?"put":"post",I=`backend.pivot.${b?"edit":"store"}`;let E=!1;b&&Object.keys(f).forEach(d=>{f[d]!=c.value[d]&&(E=!0)}),!(b&&!E)&&Z({title:`${b?"Ubah":"Tambah"} tenant`,text:k,icon:"question"},()=>P.post(H(I),{...f,_method:N,id:S.eventId},{headers:{"Content-Type":"multipart/form-data"}}).then(d=>d).catch(d=>{let $=d.response.status,D=d.response.data.message;if([409,417,500].includes($)){w.showValidationMessage(`${D}`);return}if($=="422"){const T=d.response.data.errors;D=Object.keys(T).map(l=>Array.isArray(T[l])?T[l].join(", "):T[l]).join(", "),w.showValidationMessage(`${D}`);return}})).then(({value:d,isConfirmed:$,isDismissed:D})=>{var T;if(D)return!1;$&&d.data.status=="success"&&(w.fire({title:"Tambah tenant",text:d.data.message,icon:"success"}),s(),q("submit",(T=d.data)==null?void 0:T.data),L())})};return(f,s)=>{const b=g("vue-multiselect"),k=g("FontAwesomeIcon"),N=g("b-modal");return x(),Y(N,{id:X(y),visible:O.value,"onUpdate:visible":s[1]||(s[1]=I=>O.value=I),title:"Peserta Event","hide-footer":"",onShown:F,onHide:L},{default:v(({hide:I})=>[e("div",De,[i(X(ve),{ref_key:"formRef",ref:U,onSubmit:G},{default:v(()=>[e("div",Ve,[Ie,e("div",Me,[i(X(fe),{label:"Nama tenant",name:"tenant",rules:"required"},{default:v(({field:E,errorMessage:d})=>[i(b,_e({modelValue:B.value,"onUpdate:modelValue":s[0]||(s[0]=$=>B.value=$),options:j.value,placeholder:"Pilih nama tenant",multiple:!0,"close-on-select":!1,"allow-empty":!1,"clear-on-select":!1},E,{label:"text","track-by":"value"}),null,16,["modelValue","options"]),d?(x(),M("div",Be,V(d),1)):he("",!0)]),_:1})])]),e("div",Ee,[e("div",Re,[e("button",Pe,[i(k,{icon:["fas","save"],class:"mr-1"}),J(" Simpan ")]),e("button",{type:"reset",class:"btn btn-light",onClick:I}," Batal ",8,He)])])]),_:2},1536)])]),_:1},8,["id","visible"])}}},Ue={class:"section-body"},Fe={class:"section-title fs-lg"},Ne={class:"section-lead"},Oe={class:"section-lead"},ze={class:"action-wrapper d-flex mb-3 flex-wrap align-items-center justify-content-between"},Le={class:"left-section"},Ge={class:"right-section mt-2 mt-md-0"},Ke={class:"input-group"},Xe={class:"input-group-prepend"},Je={class:"input-group-text"},Qe={class:"text-center"},We=e("span",null,"Belum ada data",-1),Ye={class:"text-center"},Ze=e("span",null,"Data tidak ditemukan",-1),et={class:"d-flex align-items-baseline justify-content-center"},tt={class:"text-right"},at={class:"d-flex flex-column"},st={class:"fs-sm text-muted"},nt={key:0},ot=["src","alt"],lt={class:"footer-wrapper"},it={class:"d-flex justify-content-between align-items-center"},rt={class:"d-flex"},ct={class:"desktop-version mr-4"},dt=e("strong",null,"Desktop/PC",-1),ut={key:0,class:"preview-wrapper"},mt=["src","alt"],pt={class:"mobile-version"},vt=e("strong",null,"Mobile",-1),ft={key:0,class:"preview-wrapper"},_t=["src","alt"],wt={__name:"Detail",props:{slug:{type:[String,null],required:!0}},setup(Q){const q=Q,S=h(null),y=h({desktop:null,mobile:null,desktopReplace:!1,mobileReplace:!1}),O=Ce(),c=h(null),U=h(null),j=ge(q,"slug"),B=Se(),{getSelectedByUrl:z}=Ae(B),F=h(!1),L=h({}),G=h({}),f=h({}),s=h({busy:!1,fields:[{key:"action",label:"Aksi",class:"text-center",sortable:!1,thStyle:{width:"35px"}},{key:"rownum",label:"No",thStyle:{width:"35px",textAlign:"center"}},{key:"name",label:"Nama Tenant",thStyle:{textAlign:"center"}}],search:{filter:null,columns:["event_name","event_header","event_subheader","location","start_at","finish_at"]},meta:{page:1,from:1,limit:15,total:0}}),b=_.debounce((l,t)=>{s.value.busy=!0,P.get(H("backend.pivot.get",{search:s.value.search.filter,columns:s.value.search.columns.join(","),page:l.currentPage,limit:l.perPage,id:q.slug})).then(n=>{var a,r,u,m,p;s.value.meta.from=(a=n.data)==null?void 0:a.meta.from,s.value.meta.page=(r=n.data)==null?void 0:r.meta.current_page,s.value.meta.limit=(u=n.data)==null?void 0:u.meta.per_page,s.value.meta.total=(m=n.data)==null?void 0:m.meta.total,t((p=n.data)==null?void 0:p.data)}).catch(()=>t([])).finally(()=>setTimeout(()=>s.value.busy=!1,500))},500),k=()=>O.push({name:"settings.event"}),N=async()=>{z.value(j.value)||await P.get(H("backend.event.get",{search:j.value,columns:"url",fetch_first:!0})).then(t=>{var n;return B.setItemByUrl(j.value,(n=t.data)==null?void 0:n.data)}).catch(t=>{var n,a;w.fire({title:"Terjadi Kesalahan",text:((a=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:a.message)||"Data event tidak ditemukan",icon:"error",timer:5e3,timerProgressBar:!0,confirmButtonText:"Kembali"}).then(({isConfirmed:r,dismiss:u})=>{(r||u=="timer")&&k()})}).finally(()=>{T(),f.value=c.value.id}),c.value=z.value(j.value)},I=()=>{var l,t;G.value=U.value??c.value,f.value=((l=U.value)==null?void 0:l.id)??((t=c.value)==null?void 0:t.id),F.value=!0},E=l=>{B.setItemByUrl(j.value,l),S.value.refresh()},d=l=>{var t;Z({title:"Hapus Tenant",text:`Apakah Anda yakin untuk menghapus tenant . ${l.name} pada event ${(t=c.value)==null?void 0:t.event_header}?`,icon:"question"},()=>{var n,a;return P.post(H("backend.pivot.drop"),{_method:"delete",id:((n=U.value)==null?void 0:n.id)??((a=c.value)==null?void 0:a.id),tenant_id:l.id}).then(r=>r).catch(r=>{let u=r.response.status,m=r.response.data.message;if([409,417,500].includes(u)){w.showValidationMessage(`${m}`);return}if(u=="422"){const p=r.response.data.errors;m=Object.keys(p).map(C=>Array.isArray(p[C])?p[C].join(", "):p[C]).join(", "),w.showValidationMessage(`${m}`);return}})}).then(({value:n,isConfirmed:a,isDismissed:r})=>{if(r)return!1;a&&n&&w.fire({title:"Hapus Tenant Berhasil",text:`Tenant ${l.name} berhasil dihapus`,icon:"success"}),S.value.refresh()})},$=({file:l,media:t})=>{if(!l)return;Z({title:"Unggah Gambar",text:`Apakah Anda yakin untuk mengunggah gambar untuk ${{desktop:"Desktop/PC",mobile:"Mobile"}[t]}?`,icon:"question"},()=>P.post(H("backend.event.upload",{eventId:f.value}),{image:l,media:t},{headers:{"Content-Type":"multipart/form-data"}}).then(a=>a).catch(a=>{let r=a.response.status,u=a.response.data.message;if([409,417,500].includes(r)){w.showValidationMessage(`${u}`);return}if(r=="422"){const m=a.response.data.errors;u=Object.keys(m).map(p=>Array.isArray(m[p])?m[p].join(", "):m[p]).join(", "),w.showValidationMessage(`${u}`);return}})).then(a=>{var r,u,m,p,C,K;a.isDismissed&&a.dismiss=="cancel"&&(y.value[t].removeImage(),y.value[`${t}Replace`]&&(y.value[`${t}Replace`]=!1)),a.isConfirmed&&((u=(r=a==null?void 0:a.value)==null?void 0:r.data)!=null&&u.data)&&w.fire({title:"Unggah Gambar",text:(p=(m=a==null?void 0:a.value)==null?void 0:m.data)==null?void 0:p.message,icon:(K=(C=a==null?void 0:a.value)==null?void 0:C.data)==null?void 0:K.status})})},D=l=>y.value[`${l}Replace`]=!0,T=ye(()=>{c.value||N()});return(l,t)=>{var ee,te,ae;const n=g("FontAwesomeIcon"),a=g("b-button"),r=g("b-table"),u=g("b-dropdown-item"),m=g("b-dropdown"),p=g("b-pagination"),C=g("el-tab-pane"),K=g("el-tabs");return x(),M("div",Ue,[e("h2",Fe,V((ee=c.value)==null?void 0:ee.event_header),1),e("p",Ne,V((te=c.value)==null?void 0:te.location),1),e("p",Oe,V((ae=c.value)==null?void 0:ae.event_subheader),1),i(K,{type:"border-card"},{default:v(()=>[i(C,{label:"Peserta"},{default:v(()=>[e("div",ze,[e("div",Le,[e("button",{class:"btn btn-icon icon-left btn-primary",onClick:I},[i(n,{icon:["fas","plus"]}),J(" Tambah ")])]),e("div",Ge,[e("div",Ke,[e("div",Xe,[e("div",Je,[i(n,{icon:["fas","search"]})])]),ke(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.search.filter=o),type:"text",class:"form-control",placeholder:"Pencarian"},null,512),[[xe,s.value.search.filter]])])])]),i(r,{ref_key:"refTable",ref:S,"table-class":"custom-bordered dataTable",fields:s.value.fields,items:X(b),filter:s.value.search.filter,"current-page":s.value.meta.page,"per-page":s.value.meta.limit,busy:s.value.busy,"show-empty":"",hover:"",striped:"",responsive:""},{"table-busy":v(()=>[i(je)]),empty:v(()=>[e("div",Qe,[i(n,{icon:["fas","exclamation-circle"],class:"mr-2"}),We])]),emptyfiltered:v(()=>[e("div",Ye,[i(n,{icon:["fas","exclamation-circle"],class:"mr-2"}),Ze])]),"cell(action)":v(({item:o})=>[e("div",et,[i(a,{variant:"link",class:"text-danger py-0 px-1 outline-none cursor-pointer",onClick:R=>d(o)},{default:v(()=>[i(n,{icon:["fas","trash-alt"]})]),_:2},1032,["onClick"])])]),"cell(rownum)":v(({index:o})=>[e("div",tt,V(o+1),1)]),"cell(name)":v(({item:o})=>[e("div",at,[J(V(o.name)+" ",1),e("span",st,V(o.short_location),1)])]),"cell(logo)":v(({value:o,item:R})=>[o.thumb?(x(),M("img",{key:1,src:o.thumb,alt:R.name,class:"image-on-table"},null,8,ot)):(x(),M("span",nt))]),_:1},8,["fields","items","filter","current-page","per-page","busy"]),e("div",lt,[e("div",it,[i(m,{variant:"light",class:"mr-2 form-control-height-sm perpage",text:s.value.meta.limit.toString()},{default:v(()=>[(x(),M(we,null,$e([5,10,15,25,50,100],o=>i(u,{key:o,"link-class":"btn",onClick:Te(R=>s.value.meta.limit=o,["prevent"])},{default:v(()=>[J(V(o),1)]),_:2},1032,["onClick"])),64))]),_:1},8,["text"]),i(p,{value:s.value.meta.page,"onUpdate:value":t[1]||(t[1]=o=>s.value.meta.page=o),"total-rows":s.value.meta.total,"per-page":s.value.meta.limit,"aria-controls":"group-table","first-class":"hidden-md-down","last-class":"hidden-md-down",class:"pagination mb-0",onChange:t[2]||(t[2]=o=>s.value.meta.page=o)},null,8,["value","total-rows","per-page"])])]),i(qe,{visible:F.value,"onUpdate:visible":t[3]||(t[3]=o=>F.value=o),"init-data":L.value,"tenant-event":G.value,"event-id":f.value,"is-edit":!1,onSubmit:E},null,8,["visible","init-data","tenant-event","event-id"])]),_:1}),i(C,{label:"Ilustrasi"},{default:v(()=>{var o,R,se,ne,oe,le,ie,re,ce,de;return[e("div",rt,[e("div",ct,[dt,(R=(o=c.value)==null?void 0:o.media)!=null&&R.desktop&&!y.value.desktopReplace?(x(),M("div",ut,[e("img",{src:(ne=(se=c.value)==null?void 0:se.media)==null?void 0:ne.desktop,alt:(oe=c.value)==null?void 0:oe.event_name,class:"image-preview"},null,8,mt),e("a",{href:"javascript:void(0)",onClick:t[4]||(t[4]=A=>D("desktop"))},[i(n,{icon:["fas","trash-alt"]})])])):(x(),Y(me,{key:1,ref:A=>y.value.desktop=A,"max-size":"1","aspec-ratio":1950/585,onCropping:t[5]||(t[5]=({file:A,urlObject:W})=>$({file:A,urlObject:W,media:"desktop"}))},null,512))]),e("div",pt,[vt,(ie=(le=c.value)==null?void 0:le.media)!=null&&ie.mobile&&!y.value.mobileReplace?(x(),M("div",ft,[e("img",{src:(ce=(re=c.value)==null?void 0:re.media)==null?void 0:ce.mobile,alt:(de=c.value)==null?void 0:de.event_name,class:"image-preview"},null,8,_t),e("a",{href:"javascript:void(0)",onClick:t[6]||(t[6]=A=>D("mobile"))},[i(n,{icon:["fas","trash-alt"]})])])):(x(),Y(me,{key:1,ref:A=>y.value.mobile=A,"max-size":"1","aspec-ratio":720/960,onCropping:t[7]||(t[7]=({file:A,urlObject:W})=>$({file:A,urlObject:W,media:"mobile"}))},null,512))])])]}),_:1})]),_:1})])}}};export{wt as default};
